<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>中彩网-测试-客服</title>

</head>

<body>

    <script>
        var __visitorId = null;
        const fpPromise = import('./fingerprintjs/v5.js')
            .then(FingerprintJS => FingerprintJS.load())
        // Get the visitor identifier when you need it.
        fpPromise
            .then(fp => fp.get())
            .then(result => {
                // This is the visitor identifier:
                __visitorId = result.visitorId;
                console.log("访客:" + __visitorId);
            });


        // 获取 URL 查询字符串参数的函数
        function getQueryString(key) {
            const params = new URLSearchParams(window.location.search);
            return key ? params.get(key) : Object.fromEntries(params);
        }

        // 获取所有查询参数的函数
        function getAllQueryParams() {
            const params = new URLSearchParams(window.location.search);
            const result = {};
            for (const [key, value] of params.entries()) {
                result[key] = value;
            }
            return result;
        }

        function setUser(userID, avatar, phoneNumber, city, companyName, desc) {
            if (!userID || userID.length <= 0) {
                userID = __visitorId;
            } else {
                userID = userID + "-" + __visitorId;
            }

            console.log("set user id:" + userID);

            window.$chatwoot.setUser(userID, {
                name: userID === __visitorId ? "游客" + __visitorId : userID,
                avatar_url: avatar || "",
                phone_number: phoneNumber || "",
                country_code: "cn",
                identifier: userID,
                //identifier_hash: "cbw-test001-hash",
                city: city || "",
                company_name: companyName || "中彩网",
                description: desc || "中彩网的客户"
            });
        }


        const userName = getQueryString("姓名") || getQueryString("vId") || getQueryString("uid") || getQueryString("id") || getQueryString("userID") || "";
        const token = getQueryString("websiteToken") || getQueryString("webToken") || getQueryString("entId") || getQueryString("token") || "";
        const avatar = getQueryString("avatar") || getQueryString("avatarUrl") || getQueryString("avatar_url") || "";
        const phoneNumber = getQueryString("phone") || getQueryString("phoneNumber") || getQueryString("phone_number") || "";
        const city = getQueryString("city") || getQueryString("cityName") || getQueryString("city_name") || "";
        const companyName = getQueryString("company") || getQueryString("companyName") || getQueryString("company_name") || "";
        const desc = getQueryString("desc") || getQueryString("description") || getQueryString("description") || "";

        (function (d, t) {
            window.chatwootSettings = { "position": "right", "type": "expanded_bubble", "launcherTitle": "联系我们" };
            var BASE_URL = "https://zcw-o0bsj.chachat.social";
            var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
            g.src = BASE_URL + "/packs/js/sdk.js";
            g.async = true;
            s.parentNode.insertBefore(g, s);
            g.onload = function () {
                window.chatwootSDK.run({
                    websiteToken: token || 'EUydVBigStqkpFot253msA6N',
                    baseUrl: BASE_URL
                })
            }

            window.addEventListener("chatwoot:ready", function () {
                console.log("Chatwoot is ready to use");
                console.log("userID=" + userName);
                setUser(userName, avatar, phoneNumber, city, companyName, desc)
            });


        })(document, "script");
    </script>
</body>

<style>
    /* 移动设备样式 - iPhone 12 Pro 及类似设备 (390px - 667px) */
    @media only screen and (max-width: 667px) {
        .woot-widget-holder {
            height: 100% !important;
            width: 100% !important;
            right: 0 !important;
            left: 0 !important;
            top: 0 !important;
            bottom: 0 !important;
            border-radius: 0 !important;
            max-height: 100vh !important;
            min-height: 100vh !important;
        }

        .woot-widget-holder iframe {
            min-height: 100% !important;
            height: 100vh !important;
        }

        .woot-widget-bubble {
            bottom: 20px !important;
            right: 20px !important;
            left: auto !important;
        }

        .woot-widget-bubble.woot-elements--left {
            left: 20px !important;
            right: auto !important;
        }
    }

    /* 平板和小屏幕设备 (390px - 667px) */
    @media only screen and (min-width: 390px) and (max-width: 667px) {
        .woot-widget-holder {
            border-radius: 0 !important;
        }
    }

    /* 桌面设备样式 */
    @media only screen and (min-width: 667px) {
        .woot-widget-holder.woot-elements--right {
            right: auto;
            left: 50%;
            transform: translateX(-50%);
        }

        .woot-widget-holder.woot-elements--left {
            left: 50%;
            transform: translateX(-50%);
        }

        .woot-widget-holder {
            border-radius: 16px;
            bottom: 104px;
            height: calc(90% - 64px - 20px);
            max-height: 640px !important;
            min-height: 250px !important;
            min-width: 667px !important;
            width: auto !important;
        }
    }

    /* 屏幕高度大于750px时增加元素高度（仅桌面设备） */
    @media only screen and (min-width: 667px) and (min-height: 750px) {

        .woot-widget-holder.woot-elements--right,
        .woot-widget-holder.woot-elements--left,
        .woot-widget-holder {
            height: calc(95% - 64px - 20px) !important;
            max-height: 800px !important;
            min-height: 500px !important;
        }
    }

    /* 触摸设备优化 */
    @media (hover: none) and (pointer: coarse) {
        .woot-widget-bubble {
            min-width: 64px;
            min-height: 64px;
        }
    }
</style>

</html>